{% extends "base.html" %}

{% block title %}Algorithm Comparison - Netflix Recommender{% endblock %}

{% block content %}
<div class="card">
    <h2>Compare Recommendation Algorithms</h2>
    <p>See how different machine learning algorithms recommend movies based on your ratings.</p>
    
    <div id="ratingCounter" class="alert alert-info">0 movies rated</div>
    
    <h3>Rate Some Movies First</h3>
    <div class="movie-grid" id="quickRating">
        <!-- Quick rating interface will be loaded here -->
    </div>
    
    <div style="text-align: center; margin: 2rem 0;">
        <button id="compareAlgorithms" class="btn btn-success" disabled>Compare All Algorithms</button>
        <a href="{{ url_for('rate_movies') }}" class="btn">Rate More Movies</a>
    </div>
</div>

<div class="card">
    <h2>Algorithm Comparison Results</h2>
    <div id="comparison">
        <p class="loading">Rate movies above to see how different algorithms compare!</p>
    </div>
</div>

<div class="card">
    <h2>Performance Metrics</h2>
    <div id="performanceMetrics">
        <p>Loading performance data...</p>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Load quick rating movies for comparison page
document.addEventListener('DOMContentLoaded', function() {
    loadQuickRatingMovies();
    loadPerformanceMetrics();
});

async function loadQuickRatingMovies() {
    try {
        const response = await fetch('/api/random_movies?count=10');
        if (response.ok) {
            const movies = await response.json();
            displayQuickRating(movies);
        }
    } catch (error) {
        console.error('Error loading movies:', error);
    }
}

function displayQuickRating(movies) {
    const container = document.getElementById('quickRating');
    let html = '';
    
    movies.forEach(movie => {
        html += `
            <div class="movie-item">
                <div class="movie-title">${movie.title}</div>
                <div class="movie-info">${movie.genre} • ${movie.year}</div>
                <div class="rating-stars">`;
        
        for (let i = 1; i <= 5; i++) {
            html += `<span class="star" data-movie-id="${movie.feature_id}" data-rating="${i}">⭐</span>`;
        }
        
        html += `</div></div>`;
    });
    
    container.innerHTML = html;
    
    // Reinitialize event listeners
    initializeEventListeners();
}

async function loadPerformanceMetrics() {
    try {
        const response = await fetch('/api/performance');
        if (response.ok) {
            const metrics = await response.json();
            displayPerformanceMetrics(metrics);
        } else {
            document.getElementById('performanceMetrics').innerHTML = 
                '<p>Performance metrics not available. Please run Phase 1 evaluation first.</p>';
        }
    } catch (error) {
        console.error('Error loading performance metrics:', error);
    }
}

function displayPerformanceMetrics(metrics) {
    const container = document.getElementById('performanceMetrics');
    
    if (!metrics || metrics.length === 0) {
        container.innerHTML = '<p>No performance data available.</p>';
        return;
    }
    
    let html = `
        <table class="comparison-table">
            <thead>
                <tr>
                    <th>Algorithm</th>
                    <th>RMSE</th>
                    <th>MAE</th>
                    <th>R² Score</th>
                    <th>Training Time</th>
                </tr>
            </thead>
            <tbody>
    `;
    
    metrics.forEach(metric => {
        html += `
            <tr>
                <td>${metric.model_name}</td>
                <td>${metric.rmse ? metric.rmse.toFixed(4) : 'N/A'}</td>
                <td>${metric.mae ? metric.mae.toFixed(4) : 'N/A'}</td>
                <td>${metric.r2_score ? metric.r2_score.toFixed(4) : 'N/A'}</td>
                <td>${metric.training_time ? metric.training_time.toFixed(2) + 's' : 'N/A'}</td>
            </tr>
        `;
    });
    
    html += '</tbody></table>';
    container.innerHTML = html;
}
</script>
{% endblock %}
